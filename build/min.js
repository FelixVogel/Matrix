/**
https://github.com/FelixVogel/Matrix
Copyright (c) 2020 Felix Vogel

For the full copyright and license information, please view the LICENSE
file that was distributed with this source code.
*/
var Utility;(function(t){var e=function(){function o(t,e,r,n){if(n===void 0){n=255}this.r=Math.max(0,Math.min(255,t));this.g=Math.max(0,Math.min(255,e));this.b=Math.max(0,Math.min(255,r));this.a=Math.max(0,Math.min(255,n))}o.fromRGBA=function(t,e,r,n){if(n===void 0){n=255}return new o(t,e,r,n)};o.fromHex=function(t){if(!t.match(/^#(:?[0-9a-fA-F]{2}){1,3}$/g))return null;var e,r,n;t=t.substr(1);for(var a=0;a<t.length;a+=2){var i=parseInt(t.substr(a,2),16);switch(a){case 0:{e=i;break}case 2:{r=i;break}case 4:{n=i;break}default:break}}return new o(e,r,n)};o.prototype.toRGBA=function(t){if(t===void 0){t=this.a}return"rgba("+this.r+", "+this.g+", "+this.b+", "+t+")"};o.prototype.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"};o.prototype.toHex=function(){return"#"+((this.r<16?"0":"")+this.r.toString(16))+((this.g<16?"0":"")+this.g.toString(16))+((this.b<16?"0":"")+this.b.toString(16))};return o}();t.Color=e;function r(t,e){for(var r=0,n=t.length;r<n;r++){e(t[r],r)}}t.forEach=r})(Utility||(Utility={}));var Color=Utility.Color;var forEach=Utility.forEach;var options={textColor:new Color(68,255,0),gradientType:0,gradientSpeed:1,lineLength:32,lineSpeed:1,rotation:0};var columns=[];var canvas=document.getElementById("matrix-canvas");var graphics=canvas.getContext("2d");var setGradient=function(){switch(options.gradientType){case 0:{forEach(columns,function(t){return t.hsv=0});break}case 1:{forEach(columns,function(t){return t.hsv=0});break}case 2:{forEach(columns,function(t){return t.hsv=360*(t.x/window.innerWidth)});break}case 3:{forEach(columns,function(t){return t.hsv=60});break}}};var rotate=function(t){canvas.width=window.innerWidth;canvas.height=window.innerHeight;canvas.style["transform"]="rotateZ("+t+"deg)";var e=canvas.getBoundingClientRect();var r=e.right-e.left;var n=e.bottom-e.top;canvas.width=r;canvas.height=n;canvas.style["transform"]="translate("+(window.innerWidth-r)/2+"px, "+(window.innerHeight-n)/2+"px) rotateZ("+t+"deg)";rebuild()};var rebuild=function(){columns=[];for(var t=1,e=canvas.width;t<e;t+=12){if(t+12>e)break;for(var r=0,n=canvas.height;r<n;r+=12)paintDot(t,r);create(t)}setGradient()};var paintRect=function(t,e,r,n,a){if(a===void 0){a="#000000"}graphics.fillStyle=a;graphics.fillRect(t,e,r,n)};var paintDot=function(t,e,r){var n=Math.max(.05,Math.min(.5,Math.random()));if(options.gradientType!==0&&r)graphics.fillStyle="hsla("+r.hsv+", 100%, 50%, "+n+")";else graphics.fillStyle=options.textColor.toRGBA(n);graphics.fillRect(t+5,e+4,2,2)};var createItem=function(){return{letters:0,max:Math.floor(Math.random()*(options.lineLength/2))+options.lineLength/2,letterY:10,erasing:false,eraseY:0,delay:Math.floor(Math.random()*8e3)+2e3}};var create=function(t){var e={x:t,interval:Math.floor(250*Math.random())+150,hsv:0,items:[createItem()]};columns.push(e)};for(var x=1;x<window.innerWidth;x+=12){if(x+12>window.innerWidth)break;for(var y=0;y<window.innerHeight;y+=12)paintDot(x,y);create(x)}var resize=function(t){canvas.width=window.innerWidth;canvas.height=window.innerHeight;rotate(options.rotation)};resize();window.addEventListener("resize",resize);var chars=[];var convertToIChar=function(t){chars=[];for(var e=0,r=t.length;e<r;e++){chars.push({offsetX:Math.floor(6-graphics.measureText(t[e]).width/2),char:t[e]})}};window.wallpaperPropertyListener={applyUserProperties:function(t){if(t.schemecolor){var e=t.schemecolor.value.split(" ").map(function(t){return Math.min(255,Math.ceil(parseFloat(t)*255))});options.textColor=Color.fromRGBA(e[0],e[1],e[2])}if(t.gradienttype){options.gradientType=parseInt(t.gradienttype.value);setGradient()}if(t.gradientspeed){options.gradientSpeed=parseInt(t.gradientspeed.value)}if(t.linelength){options.lineLength=parseInt(t.linelength.value)}if(t.linespeed){options.lineSpeed=parseInt(t.linespeed.value)}if(t.symbols){if(t.symbols.value==="")convertToIChar("ｦｱｳｴｵｶｷｹｺｻｼｽｾｿﾀﾂﾃﾅﾆﾇﾈﾊﾋﾎﾏﾐﾑﾒﾓﾔﾕﾗﾘﾜ日(+*;)-|2589Z");else convertToIChar(t.symbols.value)}if(t.rotation){options.rotation=parseInt(t.rotation.value);resize()}}};window.addEventListener("load",function(t){window.wallpaperRegisterAudioListener(function(t){if(options.gradientType!==3)return;var e=Math.floor(columns.length/2);var r=Math.floor(columns.length/128);var n=0;var a=63;for(var i=e;i>-1;i--){columns[i].hsv=240*t[a]+120;n+=1;if(n>=r){n=0;a-=1}}a=64;for(var o=e+1;o<columns.length;o++){columns[o].hsv=240*t[a]+120;n+=1;if(n>=r){n=0;a+=1}}})});var init=function(){var a=250;graphics.scale(1.2,1.2);var r=function(r){var n=false;forEach(r.items,function(t){if(t.delay<=0){paintRect(r.x,t.letterY,12,12);if(options.gradientType!==0)graphics.strokeStyle="hsl("+r.hsv+", 100%, 50%)";else graphics.strokeStyle=options.textColor.toRGB();var e=chars[Math.floor(Math.random()*chars.length)];graphics.strokeText(e.char,r.x+e.offsetX,t.letterY);t.letterY+=12;if(t.letters>=t.max&&!t.erasing){t.erasing=true;n=true}else{t.letters+=1}if(t.erasing){paintRect(r.x,t.eraseY,12,12);paintDot(r.x,t.eraseY,r);t.eraseY+=12}}else{t.delay-=a}});if(n)r.items.push(createItem());r.items=r.items.filter(function(t){return t.eraseY<canvas.height});paintRect(r.x,0,12,canvas.height,"rgba(0, 0, 0, 0.1)")};var n=0;var i=function(t){var e=t-n;forEach(columns,function(t){if(options.gradientType===1||options.gradientType===2){t.hsv+=e/100*options.gradientSpeed;if(t.hsv>=360)t.hsv=0}t.interval-=e*options.lineSpeed;if(t.interval<=0){r(t);t.interval=Math.floor(250*Math.random())+150}});n=t;window.requestAnimationFrame(i)};n=performance.now();window.requestAnimationFrame(i);setGradient()};window.addEventListener("load",function(t){return init()});