var Utility,MatrixSettingListener,Settings,SettingsStandalone,MatrixFX,MatrixBasicFX,Matrix,__extends=this&&this.__extends||function(){var o=function(t,n){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)n.hasOwnProperty(e)&&(t[e]=n[e])})(t,n)};return function(t,n){function e(){this.constructor=t}o(t,n),t.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}();!function(t){var n=(e.prototype.css=function(){return"#ffffff"},e);function e(){}t.BaseColor=n;var i,o=(__extends(r,i=n),r.fixHue=function(t){return t-360*Math.floor(t/360)},r.prototype.css=function(){return"hsl("+this.h+", "+this.s+"%, "+this.l+"%)"},r);function r(t,n,e){void 0===n&&(n=100),void 0===e&&(e=50);var o=i.call(this)||this;return o.h=t,o.s=n,o.l=e,o}t.HSLColor=o;var a,s=(__extends(g,a=n),g.fromRGBA=function(t,n,e,o){return void 0===o&&(o=255),new g(t,n,e,o)},g.fromHex=function(t){if(!t.match(/^#(:?[0-9a-fA-F]{2}){1,3}$/g))return null;var n,e,o;t=t.substr(1);for(var i=0;i<t.length;i+=2){var r=parseInt(t.substr(i,2),16);switch(i){case 0:n=r;break;case 2:e=r;break;case 4:o=r}}return new g(n,e,o)},g.prototype.toRGBA=function(t){return void 0===t&&(t=this.a),"rgba("+this.r+", "+this.g+", "+this.b+", "+t+")"},g.prototype.toRGB=function(){return"rgb("+this.r+", "+this.g+", "+this.b+")"},g.prototype.toHex=function(){return"#"+(this.r<16?"0":"")+this.r.toString(16)+(this.g<16?"0":"")+this.g.toString(16)+(this.b<16?"0":"")+this.b.toString(16)},g.prototype.css=function(){return this.toRGBA()},g);function g(t,n,e,o){void 0===o&&(o=255);var i=a.call(this)||this;return i.r=Math.max(0,Math.min(255,t)),i.g=Math.max(0,Math.min(255,n)),i.b=Math.max(0,Math.min(255,e)),i.a=Math.max(0,Math.min(255,o)),i}t.RGBColor=s;var u=(h.get=function(t){var n=new RegExp("(?:^|; )"+encodeURIComponent(t)+"=([^;]*)").exec(document.cookie);return n?new h(t,n[1]):null},h.getOrSet=function(t,n,e){var o=h.get(t);return o||(o=new h(t,n)).setExpirationDate(e).add(),o},h.replace=function(t,n,e){new h(t,n).setExpirationDate(e).add()},h.prototype.setExpirationDate=function(t){return t&&(this.expires=t),this},h.prototype.getName=function(){return decodeURIComponent(this.name)},h.prototype.getValue=function(){return decodeURIComponent(this.value)},h.prototype.setValue=function(t){return this.value=encodeURIComponent(t),this},h.prototype.add=function(){document.cookie=this.name+"="+this.value+"; expires="+this.expires.toUTCString()+"; path=/"},h.prototype.remove=function(){var t=new Date;t.setTime(t.getTime()-864e5),document.cookie=this.name+"=; expires="+t.toUTCString()+"; path=/"},h);function h(t,n){this.name=encodeURIComponent(t),this.value=encodeURIComponent(n),this.expires=new Date,this.expires.setTime(this.expires.getTime()+6048e5)}t.Cookie=u,t.forEach=function(t,n){for(var e=0,o=t.length;e<o;e++)n(t[e],e)}}(Utility=Utility||{}),MatrixSettingListener=MatrixSettingListener||{},function(o){o.DEFAULT_CANVAS_ID="#matrix-canvas",o.DEFAULT_COLUMN_WIDTH=12,o.DEFAULT_COLOR=Utility.RGBColor.fromHex("#44ff00"),o.DEFAULT_SYMBOLS="ｦｱｳｴｵｶｷｹｺｻｼｽｾｿﾀﾂﾃﾅﾆﾇﾈﾊﾋﾎﾏﾐﾑﾒﾓﾔﾕﾗﾘﾜ日(+*;)-|2589Z",o.DEFAULT_SPEED=1,o.DEFAULT_COLORING_MODE=0,o.DEFAULT_COLORING_MODE_INTERVAL=20,o.DEFAULT_LINE_LENGTH=16,o.DEFAULT_RESET_ON_FOCUS=!1,o.DEFAULT_ROTATION=0,o.TIMING_INTERVAL=250,o.MAX_LINE_LENGTH=32;var i={canvasId:o.DEFAULT_CANVAS_ID,columnWidth:o.DEFAULT_COLUMN_WIDTH,color:o.DEFAULT_COLOR,symbols:o.DEFAULT_SYMBOLS,speed:o.DEFAULT_SPEED,coloringMode:o.DEFAULT_COLORING_MODE,coloringModeInterval:o.DEFAULT_COLORING_MODE_INTERVAL,lineLength:o.DEFAULT_LINE_LENGTH,resetOnFocus:o.DEFAULT_RESET_ON_FOCUS,rotation:o.DEFAULT_ROTATION};function n(t){void 0===t&&(t=o.DEFAULT_CANVAS_ID);var n=document.querySelector(t);t&&n&&(i.canvasId=t)}function e(t){void 0===t&&(t=o.DEFAULT_COLUMN_WIDTH),t&&0<t&&(i.columnWidth=t)}function r(t){void 0===t&&(t=o.DEFAULT_COLOR),t&&MatrixSettingListener.onColorChange&&(i.color=t,MatrixSettingListener.onColorChange(t),o.loaded&&o.onColorChanged&&o.onColorChanged(t))}function a(t){void 0===t&&(t=o.DEFAULT_SYMBOLS),t&&0<t.length&&MatrixSettingListener.onSymbolsChange&&(i.symbols=t,MatrixSettingListener.onSymbolsChange(t),o.onSymbolsChanged&&o.onSymbolsChanged(t))}function s(t){void 0===t&&(t=o.DEFAULT_SPEED),t&&0<=t&&MatrixSettingListener.onSpeedChange&&(i.speed=t,MatrixSettingListener.onSpeedChange(t),o.loaded&&o.onSpeedChanged&&o.onSpeedChanged(t))}function g(t){void 0===t&&(t=o.DEFAULT_COLORING_MODE),t&&MatrixSettingListener.onColoringModeChange&&(i.coloringMode=t,MatrixSettingListener.onColoringModeChange(t),o.loaded&&o.onColoringModeChanged&&o.onColoringModeChanged(t))}function u(t){void 0===t&&(t=o.DEFAULT_COLORING_MODE_INTERVAL),t&&0<=t&&MatrixSettingListener.onColoringModeIntervalChange&&(i.coloringModeInterval=t,MatrixSettingListener.onColoringModeIntervalChange(t),o.loaded&&o.onColoringModeIntervalChanged&&o.onColoringModeChanged(t))}function h(t){void 0===t&&(t=o.DEFAULT_LINE_LENGTH),t&&1<=t&&t<=o.MAX_LINE_LENGTH&&MatrixSettingListener.onLineLengthChange&&(i.lineLength=t,MatrixSettingListener.onLineLengthChange(t),o.loaded&&o.onLineLengthChanged&&o.onLineLengthChanged(t))}function c(t){void 0===t&&(t=o.DEFAULT_RESET_ON_FOCUS),null!=t&&MatrixSettingListener.onResetOnFocusChange&&(i.resetOnFocus=t,MatrixSettingListener.onResetOnFocusChange(t),o.loaded&&o.onResetOnFocusChanged&&o.onResetOnFocusChanged(t))}function l(t){var n,e;void 0===t&&(t=o.DEFAULT_ROTATION),t&&MatrixSettingListener.onRotationChange&&(n=(e=t)-360*Math.floor(e/360),i.rotation=n,MatrixSettingListener.onRotationChange(n),o.loaded&&o.onRotationChanged&&o.onRotationChanged(t))}o.getSettings=function(){return Object.freeze(i)},o.fromJSON=function(t){n((t=t||{}).canvasId),e(t.columnWidth),r(t.color),a(t.symbols),s(t.speed),g(t.coloringMode),u(t.coloringModeInterval),h(t.lineLength),c(t.resetOnFocus),l(t.rotation)},o.loaded=!1,o.setCanvasId=n,o.getCanvas=function(){return document.querySelector(i.canvasId)},o.setColumnWidth=e,o.getColumnWidth=function(){return i.columnWidth},o.setColor=r,o.getColor=function(){return i.color},o.setSymbols=a,o.getSymbols=function(){return i.symbols},o.setSpeed=s,o.getSpeed=function(){return i.speed},o.setColoringMode=g,o.getColoringMode=function(){return i.coloringMode},o.setColoringModeInterval=u,o.getColoringModeInterval=function(){return i.coloringModeInterval},o.setLineLength=h,o.getLineLength=function(){return i.lineLength},o.generateLineLength=function(){var t=i.lineLength/2;return Math.max(0,Math.min(o.MAX_LINE_LENGTH,Math.floor(t+t*Math.random())))},o.setResetOnFocus=c,o.resetOnFocus=function(){return i.resetOnFocus},o.setRotation=l,o.getRotation=function(){return i.rotation}}(Settings=Settings||{}),function(){function o(){Utility.Cookie.replace("matrix",JSON.stringify(Settings.getSettings()))}Settings.load=function(){var t,n=null===(t=Utility.Cookie.get("matrix"))||void 0===t?void 0:t.getValue();if(n){var e=null;try{e=JSON.parse(n)}catch(t){}e&&Settings.fromJSON(e)}o()},Settings.onColorChanged=o,Settings.onSymbolsChanged=function(t){return o()},Settings.onSpeedChanged=function(t){return o()},Settings.onColoringModeChanged=function(t){return o()},Settings.onColoringModeIntervalChanged=function(t){return o()},Settings.onLineLengthChanged=function(t){return o()},Settings.onResetOnFocusChanged=function(t){return o()},Settings.onRotationChanged=function(t){return o()}}(SettingsStandalone=SettingsStandalone||{}),(MatrixFX||(MatrixFX={})).FX=function(){},function(t){var n,e=(n=MatrixFX.FX,__extends(o,n),o.prototype.reset=function(){this.hueOffset=0},o.prototype.getAllColor=function(t){return this.hueOffset=Utility.HSLColor.fixHue(this.hueOffset+360*t),new Utility.HSLColor(this.hueOffset)},o.prototype.getColumnColor=function(t,n){return this.hueOffset=Utility.HSLColor.fixHue(this.hueOffset+360*t+360/n.count*n.index),new Utility.HSLColor(this.hueOffset)},o.prototype.getLetterColor=function(t,n,e){return this.hueOffset=Utility.HSLColor.fixHue(this.hueOffset+360*t+360/e.count*e.index),new Utility.HSLColor(this.hueOffset)},o);function o(){var t=null!==n&&n.apply(this,arguments)||this;return t.hueOffset=0,t}t.BasicFX=e}(MatrixBasicFX=MatrixBasicFX||{}),function(t){var a,s,g,u=0,h=0,c=!1;t.init=function(t){void 0===t&&(t=new MatrixBasicFX.BasicFX),Settings.load(),Settings.loaded=!0,a=document.querySelector(Settings.getSettings().canvasId),s=a.getContext("2d"),n(),g=t;var i=1e3/60,r=0;!function t(){var n=Date.now(),e=1e3/Settings.getColoringModeInterval();i<=h&&(e<=r&&(l=[],c=!0,r-=e),function(){for(var t=0,n=d.length;t<n;t++)for(var e=0,o=a.height,i=Settings.getColumnWidth();e<o;e+=i)s.fillStyle=function(t,n){switch(Settings.getColoringMode()){case 0:return Settings.getColor();case 1:return c&&g.getAllColor(h),l[0];case 2:return c&&(l[t]=g.getColumnColor(h,{count:d.length,index:t})),l[t];case 3:return c&&(l[n]=g.getLetterColor(h,{count:d.length,index:t},{count:u,index:n})),l[n]}}(n,e).css(),s.fillRect(t*i,e,12,12)}(),h-=i,c=!1);var o=Date.now()-n;h+=o,r+=o,window.requestAnimationFrame(t)}()},MatrixSettingListener.onColorChange=function(t){},MatrixSettingListener.onSymbolsChange=function(t){o=[];for(var n,e=0;e<t.length;e++)o.push((n=t[e],{xOffset:Math.floor(s.measureText(n).width/2),char:n}))},MatrixSettingListener.onSpeedChange=function(t){},MatrixSettingListener.onColoringModeChange=function(t){c=!0},MatrixSettingListener.onColoringModeIntervalChange=function(t){},MatrixSettingListener.onLineLengthChange=function(t){},MatrixSettingListener.onResetOnFocusChange=function(t){},MatrixSettingListener.onRotationChange=function(t){};var o=[],l=[];var d=[];function n(){var t=Settings.getColumnWidth(),n=Math.floor((a.width-Math.floor(a.width/t)*t)/2);u=Math.ceil((a.width-n)/t*(a.height/t)),l=[],c=!0,d=[];for(var e=n;e<a.width-n;e+=t)d.push({x:e,interval:Math.floor(Settings.TIMING_INTERVAL/2+Math.random()*Settings.TIMING_INTERVAL/2),segments:[{delay:Math.random()*Settings.TIMING_INTERVAL,y:0,length:Settings.generateLineLength()}]})}t.refresh=function(){n(),s.clearRect(0,0,a.width,a.height)}}(Matrix=Matrix||{});